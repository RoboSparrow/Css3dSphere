!function(a){var b={el:null,props:{},prefixes:["ms","Moz","Webkit"],test:function(a){if(this.el||(this.el=document.createElement("div")),"undefined"!=typeof this.el.style[a])return this.props[a]=a,a;for(var b,c=a[0].toUpperCase()+a.slice(1),d=0;d<this.prefixes.length;d++)if(b=this.prefixes[d]+c,"undefined"!=typeof this.el.style[b])return this.props[a]=b,b;return this.props[a]=!1,!1},supportsPreserve3d:function(){if(!this.test("transformStyle"))return!1;var a=this.prefix("transformStyle"),b=document.createElement("div");return b.style[a]="preserve-3d","undefined"!=typeof b.style[a]&&"preserve-3d"===b.style[a]},prefix:function(a){var c;return"undefined"==typeof b.props[a]&&(c=b.test(a)),c=b.props[a],c?c:a}},c=b.prefix,d=function(a,c){this.defaults=function(){return{columns:12,rows:6,radius:300,perspective:800,translateX:0,translateY:0,translateZ:0,rotateX:0,rotateY:0,rotateZ:0,animation:"rotateY",sphereClass:null,containerClass:null,poleCaps:[90,270]}},this.state=this.defaults(),this.debug=!1,this.errors=[];for(var d=["transform","transformStyle","transition","backfaceVisibility","perspective"],e=0;e<d.length;e++)b.test(d[e])||this.errors.push(d[e]);b.supportsPreserve3d()||this.errors.push("transformStyle: preserve-3d");var f={};this.cache={get:function(a,b){return b=b||null,f.hasOwnProperty(a)?f[a]:b},set:function(a,b){var c=Object.prototype.toString.call(b);"[object Object]"!==c&&"[object Array]"!==c||(b=JSON.parse(JSON.stringify(b))),f[a]=b},purge:function(a){a=a||!1,a?delete f[a]:f={}}},this.merge(this.state,c||{}),this.cache.set("initState",this.state),this.nodes={wrapper:a,scene:document.createElement("div"),sphere:document.createElement("div"),container:document.createElement("div"),centre:document.createElement("div"),columns:[]},this.nodes.scene.className="scene",this.nodes.sphere.className="sphere",this.nodes.container.className="container",this.nodes.centre.className="sphere-centre",this.nodes.wrapper.appendChild(this.nodes.scene),this.nodes.scene.appendChild(this.nodes.sphere),this.nodes.sphere.appendChild(this.nodes.container),this.nodes.container.appendChild(this.nodes.centre),this.ok(!0)&&this.draw()};d.prototype.ok=function(a){return a=a||!1,this.errors.length?(a&&console.warn("css3sphere: not supported by this browser: "+this.errors.join(", ")),!1):!0},d.prototype.merge=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},d.prototype.nodeClasses=function(a,b,c){if(!c)return!1;if("string"==typeof a&&(a="undefined"!=typeof this.nodes[a]?this.nodes[a]:null),"undefined"==typeof a.classList)return!1;c=c.split(" ");for(var d=0;d<c.length;d++)if(c[d])switch(b){case"add":a.classList.add(c[d]);break;case"remove":a.classList.remove(c[d]);break;case"toggle":a.classList.toggle(c[d]);break;default:return!1}return a.className},d.prototype.reset=function(){this.state="undefined"!=typeof this.cache.initState?this.cache.initState:this.defaults(),this.draw()},d.prototype.updateState=function(a){if("[object Object]"!==Object.prototype.toString.call(a))return!1;var b,c,d=this.defaults();for(var e in a)a.hasOwnProperty(e)&&d.hasOwnProperty(e)&&(b=Object.prototype.toString.call(d[e]),c=Object.prototype.toString.call(a[e]),c===b&&"[object Number]"!==b||"[object Number]"===b&&(a[e]=parseInt(a[e],10),isNaN(a[e])&&delete a[e]));this.merge(this.state,a),this.draw(this.nodes.columns)},d.prototype.draw=function(a){if(this.ok()){a=a||[],this.nodes.columns=[],this.nodes.container.innerHTML="",this.nodes.scene.style.minWidth=2*this.state.radius+"px",this.nodes.scene.style.minHeight=2*this.state.radius+"px",this.nodes.container.appendChild(this.nodes.centre);for(var b,d,e={row:360/this.state.columns,column:180/this.state.rows},f={z:this.state.radius/2/Math.tan(e.column*Math.PI/180)},g=0;g<this.state.rows;g++)for(var h=0;h<this.state.columns;h++)b=this.renderColumn(g,h,e,f),b&&(this.nodes.container.appendChild(b),a.length&&(d=a.shift(),this.columnContent(d,this.nodes.columns.length-1)));this.nodes.scene.style[c("perspective")]=this.state.perspective+"px",this.containerClass(),this.sphereClass(),this.sphereTransforms(),this.sphereAnimation()}},d.prototype.renderColumn=function(a,b,d,e){var f={x:a*d.row,y:b*d.column};if(!this.isDisplayableColumn(a,f.y))return!1;var g=document.createElement("div");g.className="sphere-column row-"+a+" col-"+b,g.style[c("transform")]="rotateX("+f.x+"deg) rotateY("+f.y+"deg) translateZ("+Math.round(e.z)+"px)";var h=this.renderColumnCell(a);return g.appendChild(h),this.debug&&(h.innerText="row "+a+" col "+b),g},d.prototype.renderColumnCell=function(){var a=document.createElement("div"),b=this.nodes.columns.push(a);return a.className="column-content",a.dataset.cellIndex=b,a},d.prototype.isDisplayableColumn=function(a,b){var c=this.state.poleCaps.indexOf(b)>-1;if(c&&0!==a)return!1;for(var d=!1,e=0;e<this.state.poleCaps.length&&!(d=Math.abs(this.state.poleCaps[e]-b)<=30);e++);return!(d&&a%2)},d.prototype.sphereTransforms=function(a,b){var d=this.state;"undefined"!=typeof a&&this.state.hasOwnProperty(a)&&(d[a]=b);var e=[],f=function(){for(var a=arguments[0],b=[],c=1;c<arguments.length;c++)b.push(arguments[c]+"("+d[arguments[c]]+a+")");return b};return e=e.concat(f("px","translateX","translateY","translateZ")),e=e.concat(f("deg","rotateX","rotateY","rotateZ")),e.length&&(this.nodes.container.style[c("transform")]=e.join(" ")),!0},d.prototype.sphereAnimation=function(a){return"undefined"==typeof a&&(a=this.state.animation),this.state.animation&&"stop"===a?void this.nodeClasses("sphere","add","paused"):this.state.animation&&"play"===a?void this.nodeClasses("sphere","remove","paused"):(a!==this.state.animation&&this.nodeClasses("sphere","remove",this.state.animation),this.state.animation=a,void(this.state.animation&&this.nodeClasses("sphere","add",this.state.animation)))},d.prototype.containerClass=function(a){this.state.containerClass&&this.nodeClasses("container","remove",this.state.containerClass),"undefined"!=typeof a&&(this.state.containerClass=a),this.state.containerClass&&this.nodeClasses("container","add",this.state.containerClass)},d.prototype.sphereClass=function(a){this.state.sphereClass&&this.nodeClasses("sphere","remove",this.state.sphereClass),"undefined"!=typeof a&&(this.state.sphereClass=a),this.state.sphereClass&&this.nodeClasses("sphere","add",this.state.sphereClass)},d.prototype.columnContent=function(a,b){b="number"==typeof b?b:-1;var c=this.nodes.columns,d=function(a,b){if("undefined"==typeof c[a])return-1;for(;c[a].firstChild;)c[a].removeChild(c[a].firstChild);return"string"==typeof b?c[a].innerHTML=b:c[a].appendChild(b),a};if(b>-1)return d(b,a);for(var e=0;e<c.length;e++)d(e,a);return c.length-1},d.prototype.centreContent=function(a){if(this.nodes.centre.firstChild)for(;this.nodes.centre.firstChild;)this.nodes.centre.removeChild(this.nodes.centre.firstChild);if(!a)return this.nodes.centre;var b=document.createElement("div");b.className="centre-content",this.nodes.centre.appendChild(b),"string"==typeof a?b.innerHTML+=a:b.appendChild(a)},d.prototype.line=function(a,b){b=b||"rgb(255, 255, 255)";var d=document.createElement("div");return d.className="sphere-line",d.style.position="absolute",d.style.width=a,d.style.left=0,d.style.top="50%",d.style.height="1px",d.style.borderBottomWidth="1px",d.style.borderBottomStyle="solid",d.style.borderBottomColor=b,d.style[c("backfaceVisibility")]="visible",d},d.prototype.coordinates=function(){var a="100%",b=this.line(a,"red");this.centreContent(b,!0);var d=this.line(a,"blue");d.style[c("transform")]="rotateY(90deg)",this.centreContent(d,!0);var e=this.line(a,"green");return e.style[c("transform")]="rotateZ(90deg)",this.centreContent(e,!0),this.nodes.centre},a.Sphere=d}(window);