!function(a){var b={el:null,props:{},prefixes:["ms","Moz","Webkit"],test:function(a){if(this.el||(this.el=document.createElement("div")),"undefined"!=typeof this.el.style[a])return a;for(var b,c=a[0].toUpperCase()+a.slice(1),d=0;d<this.prefixes.length;d++)if(b=this.prefixes[d]+c,"undefined"!=typeof this.el.style[b])return b;return!1},prefix:function(a){var b;return"undefined"==typeof this.props[a]&&(b=this.test(a)),b=this.props[a],b?b:a}},c=function(a,c){this.defaults=function(){return{columns:12,rows:6,radius:300,perspective:800,translateX:0,translateY:0,translateZ:0,rotateX:0,rotateY:0,rotateZ:0,animation:"rotateY",sphereClass:null,poleCaps:[90,270]}},this.state=this.defaults(),this.debug=!1,this.errors=[];for(var d=["transform","transition","backfaceVisibility","perspective"],e=0;e<d.length;e++)b.test(d[e])||this.errors.push(d[e]);var f={};this.cache={get:function(a,b){return b=b||null,f.hasOwnProperty(a)?f[a]:b},set:function(a,b){var c=Object.prototype.toString.call(b);"[object Object]"!==c&&"[object Array]"!==c||(b=JSON.parse(JSON.stringify(b))),f[a]=b},purge:function(a){a=a||!1,a?delete f[a]:f={}}},this.merge(this.state,c||{}),this.cache.set("initState",this.state),this.nodes={wrapper:a,scene:document.createElement("div"),sphere:document.createElement("div"),container:document.createElement("div"),centre:document.createElement("div"),columns:[]},this.nodes.scene.className="scene",this.nodes.sphere.className="sphere",this.nodes.container.className="container",this.nodes.centre.className="sphere-centre",this.nodes.wrapper.appendChild(this.nodes.scene),this.nodes.scene.appendChild(this.nodes.sphere),this.nodes.sphere.appendChild(this.nodes.container),this.nodes.container.appendChild(this.nodes.centre),this.ok(!0)&&this.draw()};c.prototype.ok=function(a){return a=a||!1,this.errors.length?(a&&console.warn("css3sphere: not supported by this browser: "+this.errors.join(", ")),!1):!0},c.prototype.merge=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},c.prototype.reset=function(){this.state="undefined"!=typeof this.cache.initState?this.cache.initState:this.defaults(),this.draw()},c.prototype.updateState=function(a){if("[object Object]"!==Object.prototype.toString.call(a))return!1;var b,c,d=this.defaults();for(var e in a)a.hasOwnProperty(e)&&d.hasOwnProperty(e)&&(b=Object.prototype.toString.call(d[e]),c=Object.prototype.toString.call(a[e]),c===b&&"[object Number]"!==b||"[object Number]"===b&&(a[e]=parseInt(a[e],10),isNaN(a[e])&&delete a[e]));this.merge(this.state,a),this.draw(this.nodes.columns)},c.prototype.draw=function(a){if(this.ok()){a=a||[],this.nodes.columns=[],this.nodes.container.innerHTML="",this.nodes.scene.style.minWidth=2*this.state.radius+"px",this.nodes.scene.style.minHeight=2*this.state.radius+"px",this.nodes.container.appendChild(this.nodes.centre);for(var b,c,d={row:360/this.state.columns,column:180/this.state.rows},e={z:this.state.radius/2/Math.tan(d.column*Math.PI/180)},f=0;f<this.state.rows;f++)for(var g=0;g<this.state.columns;g++)b=this.renderColumn(f,g,d,e),b&&(this.nodes.container.appendChild(b),a.length&&(c=a.shift(),this.columnContent(c,this.nodes.columns.length-1)));this.nodes.scene.style.perspective=this.state.perspective+"px",this.sphereClass(),this.sphereTransforms(),this.sphereAnimation()}},c.prototype.renderColumn=function(a,b,c,d){var e={x:a*c.row,y:b*c.column};if(!this.isDisplayableColumn(a,e.y))return!1;var f=document.createElement("div");f.className="sphere-column row-"+a+" col-"+b,f.style.transform="rotateX("+e.x+"deg) rotateY("+e.y+"deg) translateZ("+Math.round(d.z)+"px)";var g=this.renderColumnCell(a);return f.appendChild(g),this.debug&&(g.innerText="row "+a+" col "+b),f},c.prototype.renderColumnCell=function(){var a=document.createElement("div"),b=this.nodes.columns.push(a);return a.className="column-content",a.dataset.cellIndex=b,a},c.prototype.isDisplayableColumn=function(a,b){var c=this.state.poleCaps.indexOf(b)>-1;if(c&&0!==a)return!1;for(var d=!1,e=0;e<this.state.poleCaps.length&&!(d=Math.abs(this.state.poleCaps[e]-b)<=30);e++);return!(d&&a%2)},c.prototype.sphereTransforms=function(a,b){var c=this.state;"undefined"!=typeof a&&this.state.hasOwnProperty(a)&&(c[a]=b);var d=[],e=function(){for(var a=arguments[0],b=[],d=1;d<arguments.length;d++)b.push(arguments[d]+"("+c[arguments[d]]+a+")");return b};return d=d.concat(e("px","translateX","translateY","translateZ")),d=d.concat(e("deg","rotateX","rotateY","rotateZ")),d.length&&(this.nodes.container.style.transform=d.join(" ")),!0},c.prototype.sphereAnimation=function(a){return this.state.animation&&"stop"===a?void this.nodes.sphere.classList.add("paused"):this.state.animation&&"play"===a?void this.nodes.sphere.classList.remove("paused"):(this.state.animation&&this.nodes.sphere.classList.remove(this.state.animation),"undefined"!=typeof a&&(this.state.animation=a),void(this.state.animation&&this.nodes.sphere.classList.add(this.state.animation)))},c.prototype.sphereClass=function(a){this.state.sphereClass&&this.nodes.sphere.classList.remove(this.state.sphereClass),"undefined"!=typeof a&&(this.state.sphereClass=a),this.state.sphereClass&&this.nodes.sphere.classList.add(this.state.sphereClass)},c.prototype.columnContent=function(a,b){b="number"==typeof b?b:-1;var c=this.nodes.columns,d=function(a,b){if("undefined"==typeof c[a])return-1;for(;c[a].firstChild;)c[a].removeChild(c[a].firstChild);return"string"==typeof b?c[a].innerHTML=b:c[a].appendChild(b),a};if(b>-1)return d(b,a);for(var e=0;e<c.length;e++)d(e,a);return c.length-1},c.prototype.centreContent=function(a){if(this.nodes.centre.firstChild)for(;this.nodes.centre.firstChild;)this.nodes.centre.removeChild(this.nodes.centre.firstChild);if(!a)return this.nodes.centre;var b=document.createElement("div");b.className="centre-content",this.nodes.centre.appendChild(b),"string"==typeof a?b.innerHTML+=a:b.appendChild(a)},c.prototype.line=function(a,b){b=b||"rgb(255, 255, 255)";var c=document.createElement("div");return c.className="sphere-line",c.style.position="absolute",c.style.width=a,c.style.left=0,c.style.top="50%",c.style.height="1px",c.style.borderBottomWidth="1px",c.style.borderBottomStyle="solid",c.style.borderBottomColor=b,c.style.backfaceVisibility="visible",c},c.prototype.coordinates=function(){var a="100%",b=this.line(a,"red");this.centreContent(b,!0);var c=this.line(a,"blue");c.style.transform="rotateY(90deg)",this.centreContent(c,!0);var d=this.line(a,"green");return d.style.transform="rotateZ(90deg)",this.centreContent(d,!0),this.nodes.centre},a.Sphere=c}(window);