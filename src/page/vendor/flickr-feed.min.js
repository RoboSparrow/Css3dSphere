/**
 * FlickrFeeds - v0.0.1 - 2016-04-13
 * Copyright (c) 2016 
 * Licensed MIT <https://opensource.org/licenses/MIT>
 */

!function(a){"use strict";var b=a.document,c=[],d=function(a,b){var c=[];for(var e in b)c.push(encodeURIComponent(e)+"="+encodeURIComponent(b[e]));return c.length?a+"?"+c.join("&"):d},e=function(a,e,f,g){e=e||{};var h,j=b.createElement("script");return h=g?f:function(a){f(new i(a)),b.head.removeChild(j)},c.push(h),e.format="json",e.jsoncallback="Flickr.callbacks["+(c.length-1)+"]",j.src=d(a,e),b.head.appendChild(j),j},f=function(a){return a.reduce(function(a,b){return a.indexOf(b)<0&&a.push(b.trim()),a},[])},g=function(a,b){return a.filter(function(a){return-1!=b.indexOf(a)})},h=function(a){return a=a||[],"string"==typeof a&&(a=a.indexOf(",")>-1?a.split(","):a.split(" ")),a},i=function(a){if(this.error=!1,"string"==typeof a){var b=/<title>(.*?)<\/title>/.exec(a);this.error=b?b:a}if(!this.error)for(var c in a)if(a.hasOwnProperty(c)){if("items"===c){this.items=[];for(var d=0;d<a.items.length;d++)this.items.push(new j(a.items[d]));continue}this[c]=a[c]}};i.prototype.getUsers=function(){for(var a=function(a,b){return a.name<b.name?-1:a.name>b.name?1:0},b=[],c=0;c<this.items.length;c++)b.push(this.items[c].getUser());return b.sort(a)},i.prototype.getTags=function(a){for(var b=[],c=0;c<this.items.length;c++)b=b.concat(this.items[c].getTags());return f(b).sort()},i.prototype.getItemsByTags=function(a){for(var b=[],c=0;c<this.items.length;c++)this.items[c].hasTags(a)&&b.push(this.items[c]);return b};var j=function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])};j.prototype.getUser=function(){var a=/\(([^)]+)\)/,b=a.exec(this.author);return{id:this.author_id,name:b&&b.length>0?b[1]:this.author}},j.prototype.getImage=function(){return this.hasOwnProperty("media")&&this.media.hasOwnProperty("m")?this.media.m:null},j.prototype.getTags=function(){return h(this.tags)},j.prototype.hasTags=function(a){a=h(a);var b=this.getTags(a);return g(a,b).length},j.prototype.getDatePublished=function(){return this.hasOwnProperty("published")?new Date(this.published):null},j.prototype.getDateTaken=function(){return this.hasOwnProperty("date_taken")?new Date(this.date_taken):null};var k=function(a){return this.query={},this.id=a,this.raw=!1,this.feed=null,this.endpoint=null,this.callback=function(a){},this};k.prototype.options=function(a){a=a||{};for(var b in a)if(a.hasOwnProperty(b)){if(this.query.hasOwnProperty(b))continue;this.query[b]=a[b]}},k.prototype.register=function(a){this.feed=a,this.id=a.substr(a.lastIndexOf("/")+1)},k.prototype.prepareQuery=function(){var a=JSON.parse(JSON.stringify(this.query));switch(this.id){case"activity.gne":case"photos_friends.gne":case"photos_comments.gne":a.user_id=a.id,delete a.id}if("undefined"!=typeof a.ids&&(a.ids=f(a.ids).join(",")),"undefined"!=typeof a.tags){var b=f(a.tags);a.tags=b.join(",")}return a},k.prototype.raw=function(){return this.raw=!0,this},k.prototype.ready=function(a){var b=this.prepareQuery();return e(this.feed,b,a,this.raw),this},k.prototype.Photos=function(a){return a=a||!1,this.id||this.register("http://api.flickr.com/services/feeds/photos_public.gne"),this.options(a),this},k.prototype.User=function(a){return this.options({id:a}),this},k.prototype.Friends=function(a,b){return this.options({display_all:a||!1,friends:b?1:0}),this.register("https://api.flickr.com/services/feeds/photos_friends.gne"),this},k.prototype.Favourites=function(){return this.register("https://api.flickr.com/services/feeds/photos_faves.gne"),this},k.prototype.Activity=function(){return this.register("https://api.flickr.com/services/feeds/activity.gne"),this},k.prototype.Comments=function(){return this.register("https://api.flickr.com/services/feeds/photos_comments.gne"),this},k.prototype.Users=function(a){return a=h(a),this.options({ids:a}),this},k.prototype.Group=function(a){return a=a||[],this.options({id:a}),this},k.prototype.Discussion=function(){return this.register("https://api.flickr.com/services/feeds/groups_discuss.gne"),this},k.prototype.Pool=function(){return this.register("https://api.flickr.com/services/feeds/groups_pool.gne"),this},k.prototype.Forums=function(){return this.register("https://api.flickr.com/services/feeds/forums.gne"),this},k.prototype.Tags=function(a,b){return a=h(a),b=b||!1,this.options({tags:a,tagmode:b?"ALL":"ANY"}),this};var l={callbacks:c,Feed:function(a){return new k(a)}};a.Flickr=l}(window);